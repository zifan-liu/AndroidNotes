# Binder 
Binder是什么
* 进程间通信机制
* 也是一个驱动
* Binder.java -> 实现 iBinder接口 --- 跨进程能力


多进程通信eg:
>自己创建的进程的：webView 视频播放，音乐播放，大图浏览，推送
>系统服务： 打电话，闹钟，AMS等等

多进程通信优点：
>内存：单个进程（单个jvm）分配的内存有限，一个app开启多个进程，可以扩大内存占用
>安全隔离：风险隔离，危险操作放到单独进程中


对比linux进程通信机制：管道、信号量、socket、共享内存

binder性能 < 共享内存，但是优于其他IPC进程间通信
（见ppt p9

* Binder如何做到一次拷贝

进程间内存隔离，详细内存划分
(见ppt p12


mmap的原理讲解
(见ppt p20


Binder如何启动
(图片 桌面binder.png

1. binder_init
    1.分配内存
    2.初始化设备
    3.放入链表 binder——devices

2. binder_open
    1.创建binder_proc对象
    2.当前进程信息保存到proc
    3.filp->private_data = proc;
    4.添加到binder_procs链表中

3. binder_mmap
    1.通过用户空间的虚拟内存大小 --- 分配一块内核的虚拟内存
    2.分配一块物理内存 --- 4KB
    3.把这块物理内存分别映射到 用户空间的虚拟内存和内核的虚拟内存

4. binder_ioctl
    读写操作---BINDER_WRITE_READ 


Binder在JNI层加载流程
init.zygote32.rc ---> app_main.cpp.main() ---> AndroidRuntime.start() ---> startReg(JNIEnv* env) ---> register_jni_procs(gRegJNI, NELEM(gRegJNI), env) --->  REG_JNI(register_android_os_Binder) ---> andorid_util_Binder.cpp.int_register_android_os_Binder()

目的：java和native能够互相调用


